package ARm8.addon.modules.exploits;

import ARm8.addon.Addon;
import meteordevelopment.meteorclient.systems.modules.Module;
import net.minecraft.entity.vehicle.BoatEntity;
import net.minecraft.network.packet.c2s.play.VehicleMoveC2SPacket;
import net.minecraft.util.math.Vec3d;

public class BoatExecute extends Module {
 
    public BoatExecute() {
        super(Addon.EXPLOITS, "boat-execute", "Instantly kills both you and the player you're riding in a boat.");
    }

    @Override
    public void onActivate() {
        if(!(mc.player.getVehicle() instanceof BoatEntity boat)){
            toggle();
            return;
        }

        Vec3d originalPos = boat.getPos();
        boat.setPosition(originalPos.add(0, 0.05, 0));
        VehicleMoveC2SPacket groundPacket = new VehicleMoveC2SPacket(boat); // low packet

        boat.setPosition(originalPos.add(0, 20, 0));
        VehicleMoveC2SPacket skyPacket = new VehicleMoveC2SPacket(boat);    // high packet
        boat.setPosition(originalPos);  // reset

        // build up fall damage
        for (int i = 0; i < 20; i++){
            mc.getNetworkHandler().sendPacket(skyPacket);
            mc.getNetworkHandler().sendPacket(groundPacket);
        }

        // apply fall damage
        mc.getNetworkHandler().sendPacket(new VehicleMoveC2SPacket(boat));

        toggle();
    }
}
